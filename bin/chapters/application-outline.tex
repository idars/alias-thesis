\chapter{Application outline}
\label{ch:outline}

Throughout this project, an implementation of the application has been planned. This chapter outlines how such an implementation may look like.

\section{Implementation details}

Following the reasoning in \autoref{sec:iteration6} and \autoref{sec:appsetup}, the current approach is to split the application in two; an web application for patients (optimized for tablets) and a web application for the staff (optimized for desktop). The avatar generation system is to be integrated into both applications. An extended use case diagram is shown in \autoref{fig:usecases2} to reflect these changes.

\begin{figure}
    \centering
    \includegraphics[width=1\textwidth]{use-cases-implementation.pdf}
    \caption{Extended use case diagram}
    \label{fig:usecases2}
\end{figure}

A revised and more detailed domain model is shown in \autoref{fig:domainmodel2}. Here, the concepts of the domain are further analysed and made more concrete. A procedure is now made up of several \emph{pages} and a textual \emph{document}. Each page may include a drawing, a video or an image depending on its source. The user's avatar is only displayed in a DrawingPage. The concepts of PictogramApp (stories and scenes) are carried over to the application as well, although named as \emph{procedures} and \emph{steps} respectively.

\begin{figure}
    \centering
    \includegraphics[width=1\textwidth]{domain-model-implementation.pdf}
    \caption{Extended domain model}
    \label{fig:domainmodel2}
\end{figure}

\section{Architecture}

The architecture follows a similar pattern to many production-scale web applications, being based on web- and application servers. The web servers are exposed through a firewall, making them accessible through a web browser. Following the non-functional requirements (and for extra security), the application may be exposed only to specific devices in the networks used at the relevant hospitals.

The application as it is planned involves an ASP.NET Core backend, using a framework resembling the one used at Helse Vest IKT. This setup is distributed across one or more application servers. To better support JSON data structures, the database system will consist of a document-oriented NoSQL database, optionally with load balancers.

The web servers may be shaped in many ways, but the suggested approach is to start with a base navigation framework such as Angular, Ionic or React on a Node.js runtime and combine it with other frameworks that are needed for the task at hand. The server will then communicate with the application servers for data traversing and storage. The web- and application servers may also be merged if the costs are too high and the gains are too low.

When it comes to how graphical procedures and avatars are stored, they are best suited as JSON objects. An example of how a procedure may be represented in JSON format is shown in \autoref{fig:json-procedure}.

\begin{figure}
    \begin{lstlisting}[language=json]
{
    "procedure": {
        "title": "Test procedure",
        "modifiedAt": "2019-06-30 17:32:23GMT+2",
        "scheduledAt": "2019-07-07 10:00:00GMT+2",
        "pages": [
            {
                "type": "drawing",
                "data": [
                    (...)
                ]
            },
            {
                "type": "video",
                "source": "https://youtu.be/(...)"
            },
            {
                "type": "image",
                "source": "https://(...)"
            }
        ],
        "measurements": {
            "publishedAt": "2019-07-08 08:40:33GMT+2",
            "comment": "Test measurements",
            "data": [
                {
                    "name": "Blood pressure",
                    "value": "120/80",
                    "unit": "mmHg"
                }
            ]
        },
        "rating": {
            "ratedAt": "2019-07-07 12:01:50GMT+2",
            "comment": "Test rating",
            "data": [
                {
                    "name": "happy",
                    "value": 60
                },
                {
                    "name": "sad",
                    "value": 24
                },
                (...)
            ]
        }
    }
}
    \end{lstlisting}
    \caption{An example procedure as described in JSON format}
    \label{fig:json-procedure}
\end{figure}

\section{Integration with existing systems}

When viewing this application together with existing systems, it has several connections that must be implemented. The application is supposed to be used in correlation with guideline pathways, and the flow of information can be seen in light of a guideline pathway. The model seen in \autoref{fig:applicationmodel} takes the guideline pathway of mental disorders for children and youth \autocite{haugland2018} as an example.

\begin{figure}
    \centering
    \includegraphics[width=1\textwidth]{application-model.pdf}
    \caption{Application model as illustrated through a guideline pathway}
    \label{fig:applicationmodel}
\end{figure}

The application is also to be integrated with existing information and journal systems. Details about these are not widely known and thus only speculations can be made. Information about procedures and appointments are fetched from these systems, updated as necessary. The graphical procedures are currently meant to be stored separately in the NoSQL database. Ratings can also be reflected in journals, supplying an extra dimension to each patient's journal.

\section{Anticipated challenges and feasibility}
\label{sec:anticipatedchallenges}

The development tools chosen for an application should support the functionality of the application. The following subsections illustrate a few scenarios which the chosen development tools should support.

\subsection{Personalised avatars}

The avatar generation system created for E-LAN (from \autoref{sec:relatedwork}) can be used together with the application. This enables the user to view their avatar in procedures like they were participating themselves. A challenge lies in associating an avatar to each user while making it easy to modify it when needed. The system is based on a graphical user interface and does not present an API; it is very much a black box where the result is an exported PNG file.

\subsection{Realistic avatar projections}

The system outputs two-dimensional portrait images only, with the face and chest facing forward. The images are also limited to the top part of the body, leaving the lower body out. Concerns were raised about whether these images would look realistic in certain settings. For example, using a single 2D image, a person laying in the bed would look awkward unless viewed from above the bed. \Cref{tab:projecting-avatar} lists several approaches to this issue.

% Figure showing avatar

% Figure with 4 images showing the different projections?

\begin{table}
    \centering
    \begin{tabu}{L[0.75] l L[0.5] l L}
        \textbf{} & \textbf{Realism} & \textbf{Processing \newline power} & \textbf{Ease of use} & \textbf{Additional \newline requirements} \\ \hline
        \textbf{2D images} & Lowest & Lowest & Highest & None \\ \tabucline[hdottedline]{-}
        \textbf{2D image sets with various poses} & High & Low & High & Extra image sets \\ \tabucline[hdottedline]{-}
        \textbf{2D images rotated in 3D} & Low & High & Low & Software framework which supports 3D rotations \\ \tabucline[hdottedline]{-}
        \textbf{3D models} & Highest & Highest & Lowest & New 3D models; a 3D rendering engine; software framework which supports 3D rotations \\ \hline
    \end{tabu}
    \caption{Different ways to project an avatar on a screen}
    \label{tab:projecting-avatar}
\end{table}

It is shown that 2D images can be rotated in 3D pretty realistically. \textcite{rivers2010} carried out a project which showed that it is possible to view a figure from any angle when given three 2D projections of it. Though, an alternative is to simply use such avatars in 2D-space. The IACTA application shows that this can be used with similar effect as a 3D-application \autocite{stalberg2018}.

% \subsection{Visual art and template designs}

% This brings us to the next challenge. (...)

% \subsection{Connections between client and administrator applications}

% (...)

% \subsection{Integrations towards current healthcare systems}

% (...)

% \subsection{Security concerns}

% (...)

% \subsection{Service workers and offline content}

% (...)

% % Experimental technology
% % Not-so-easy with web projects

% \subsection{Scaling}

% (...)

% \subsection{Costs}

% (...)

\section{Handoff}

The scope of this project involves minimal integration with existing healthcare and journal systems at the Children and Youth Clinic and Haukeland University Hospital. Given that Helse Vest IKT monitors most of said systems, it would be sensible to develop an application that can be adapted, or even be developed further on, by them. It was pointed out that the developers of the avatar generation system used well-established web technologies such as HTML, CSS and JavaScript to develop it, and that similar technologies were preferred for the new application. This led to a new direction in choosing the most suitable software tools.

Attached to this thesis are Figma project files for the client and administrator applications. The former is interactive and the one used in this project's evaluation. % and source code for an incomplete software prototype using React and create-react-app.

(...)
